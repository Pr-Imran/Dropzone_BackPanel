@using DropZone_BackPanel.Areas.Dboard.Model
@using DropZone_BackPanel.Helpers
@model FileLimitsViewModel

@{
    ViewData["Title"] = "File Limits";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/choices.min.css">
<style>
    .btn-link {
        color: white;
    }

    .modal-heading h4 {
        color: #ffffff;
    }

    .form-control {
        border-radius: 20px;
    }

    .btn-success {
        border-radius: 10px;
    }

    label {
        color: black;
    }

    .choices {
        width: 100% !important;
    }
</style>

<!-- File Limits Form -->
<div class="container py-5">
    <h4 class="text-left">Add File Limits</h4>
    <hr />
    <form id="fileLimitsForm">
        <input type="hidden" id="fileLimitsId" name="Id" value="0" />

        <div class="row">
            <div class="col-6">
                <div class="form-group">
                    <label for="fileTypeId">File Type</label>
                    <select id="fileTypeId" name="fileTypeId" class="form-control" required>
                        @foreach (var fileType in Model.fileTypes)
                        {
                            <option value="@fileType.Id">@fileType.fileTypeName</option>
                        }
                    </select>
                </div>
            </div>
            <div class="col-6">
                <div class="form-group">
                    <label for="hourFileNo">Hourly File Number</label>
                    <input type="number" id="hourFileNo" name="hourFileNo" class="form-control" placeholder="Enter hourly file number" required />
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-6">
                <div class="form-group">
                    <label for="hourFileSize">Hourly File Size (MB)</label>
                    <input type="number" id="hourFileSize" name="hourFileSize" class="form-control" placeholder="Enter hourly file size" required />
                </div>
            </div>
            <div class="col-6">
                <div class="form-group">
                    <label for="dayFileNo">Daily File Number</label>
                    <input type="number" id="dayFileNo" name="dayFileNo" class="form-control" placeholder="Enter daily file number" required />
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-6">
                <div class="form-group">
                    <label for="dayFileSize">Daily File Size (MB)</label>
                    <input type="number" id="dayFileSize" name="dayFileSize" class="form-control" placeholder="Enter daily file size" required />
                </div>
            </div>
            <div class="col-6">
                <div class="form-group">
                    <label for="totalFileNo">Total File Number</label>
                    <input type="number" id="totalFileNo" name="totalFileNo" class="form-control" placeholder="Enter total file number" required />
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-6">
                <div class="form-group">
                    <label for="totalFileSize">Total File Size (MB)</label>
                    <input type="number" id="totalFileSize" name="totalFileSize" class="form-control" placeholder="Enter total file size" required />
                </div>
            </div>
            <div class="col-6">
                <div class="form-group">
                    <label for="alertFileSize">Alert File Size (MB)</label>
                    <input type="number" id="alertFileSize" name="alertFileSize" class="form-control" placeholder="Enter alert file size" required />
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-6">
                <div class="form-group">
                    <label for="archiveFileSize">Archive File Size (MB)</label>
                    <input type="number" id="archiveFileSize" name="archiveFileSize" class="form-control" placeholder="Enter archive file size" required />
                </div>
            </div>
            <div class="col-6">
                <div class="form-group">
                    <label for="archivingMonth">Archiving Month</label>
                    <input type="number" id="archivingMonth" name="archivingMonth" class="form-control" placeholder="Enter archiving month" required />
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-6">
                <div class="form-group">
                    <label for="isActive">Status</label>
                    <select id="isActive" name="isActive" class="form-control" required>
                        <option value="true">Active</option>
                        <option value="false">Inactive</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="form-group text-center">
            <button type="submit" class="btn btn-success btn-lg">Save</button>
        </div>
    </form>
</div>

<!-- File Limits Table -->
<div class="container table-responsive py-5">
    <table class="table table-bordered table-hover" id="fileLimitsTable">
        <thead class="" style="background-color: #827EEF;">
            <tr>
                <th scope="col">Sl</th>
                <th scope="col">File Type</th>
                <th scope="col">Hourly File No</th>
                <th scope="col">Hourly File Size</th>
                <th scope="col">Daily File No</th>
                <th scope="col">Daily File Size</th>
                <th scope="col">Total File No</th>
                <th scope="col">Total File Size</th>
                <th scope="col">Alert File Size</th>
                <th scope="col">Archive File Size</th>
                <th scope="col">Archiving Month</th>
                <th scope="col">Status</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.fileLimites != null)
            {
                var index = 1;
                foreach (var item in Model.fileLimites)
                {
                    <tr>
                        <th scope="row">@index</th>
                        <td>@item.fileType?.fileTypeName</td>
                        <td>@item.hourFileNo</td>
                        <td>@item.hourFileSize</td>
                        <td>@item.dayFileNo</td>
                        <td>@item.dayFileSize</td>
                        <td>@item.totalFileNo</td>
                        <td>@item.totalFileSize</td>
                        <td>@item.alertFileSize</td>
                        <td>@item.archiveFileSize</td>
                        <td>@item.archivingMonth</td>
                        <td>@(item.isActive ? "Active" : "Inactive")</td>
                        <td>
                            <a class="btn btn-info" onclick="editFileLimits( @item.Id, @item.fileTypeId, @item.hourFileNo, @item.hourFileSize, @item.dayFileNo, @item.dayFileSize, @item.totalFileNo, @item.totalFileSize, @item.alertFileSize, @item.archiveFileSize, @item.archivingMonth, '@item.isActive' )" href="javascript:void(0)"> <i class="fa fa-edit"></i> </a>
                        </td>
                    </tr>
                    index++;
                }
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#fileLimitsTable').DataTable();

            // Handle form submission via AJAX
            $("#fileLimitsForm").on("submit", function (e) {
                e.preventDefault();

                // Get form data
                var formData = {
                    Id: $("#fileLimitsId").val(),
                    fileTypeId: $("#fileTypeId").val(),
                    hourFileNo: $("#hourFileNo").val(),
                    hourFileSize: $("#hourFileSize").val(),
                    dayFileNo: $("#dayFileNo").val(),
                    dayFileSize: $("#dayFileSize").val(),
                    totalFileNo: $("#totalFileNo").val(),
                    totalFileSize: $("#totalFileSize").val(),
                    alertFileSize: $("#alertFileSize").val(),
                    archiveFileSize: $("#archiveFileSize").val(),
                    archivingMonth: $("#archivingMonth").val(),
                    isActive: $("#isActive").val() === "true"
                };

                // Send AJAX request to save file limit
                $.ajax({
                    url: '@Url.Action("SaveFileLimits", "MasterData", new { area = "Dboard" })',
                    type: 'POST',
                    data: formData,
                    success: function (response) {
                        console.log(response);
                        if (response.success) {
                            Swal.fire("Success!", "File limit saved successfully.", "success").then(() => {
                                location.reload();
                            });

                        } else {
                            Swal.fire('Error', 'Error saving file limit.', 'error');
                        }
                    },
                    error: function () {
                        Swal.fire('Error', 'Something went wrong while saving the file limit.', 'error');
                    }
                });
            });
        });

        function editFileLimits(id, fileTypeId, hourFileNo, hourFileSize, dayFileNo, dayFileSize, totalFileNo, totalFileSize, alertFileSize, archiveFileSize, archivingMonth, isActive) {
            $("#fileLimitsId").val(id);
            $("#fileTypeId").val(fileTypeId);
            $("#hourFileNo").val(hourFileNo);
            $("#hourFileSize").val(hourFileSize);
            $("#dayFileNo").val(dayFileNo);
            $("#dayFileSize").val(dayFileSize);
            $("#totalFileNo").val(totalFileNo);
            $("#totalFileSize").val(totalFileSize);
            $("#alertFileSize").val(alertFileSize);
            $("#archiveFileSize").val(archiveFileSize);
            $("#archivingMonth").val(archivingMonth);

            // Convert True/False to "true"/"false"
            const isActiveString = isActive === "True" ? "true" : "false";
            $("#isActive").val(isActiveString);

            // Scroll to the form or highlight it
            $('html, body').animate({ scrollTop: $(".form-section").offset().top }, 'slow');
        }

    </script>
}
